<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bullish Sweeps Entry</title>
  <meta name="description" content="Submit your Bullish Sweeps entries" />
  <style>
    :root {
      --bg: #0b0b14;
      --card: #171728;
      --text: #e8e8ff;
      --muted: #9aa0b6;
      --accent: #a64dff;
      --accent2: #ff4dc4;
      --ok: #36c275;
      --err: #ff6b6b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(60rem 60rem at 20% 10%, rgba(166,77,255,.12), transparent 60%),
        radial-gradient(50rem 50rem at 80% 0%, rgba(255,77,196,.08), transparent 60%),
        var(--bg);
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: 100%;
      max-width: 780px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)), var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      padding: 24px;
    }
    h1 {
      margin: 0 0 8px;
      font-size: clamp(20px, 3vw, 32px);
      letter-spacing: 0.3px;
    }
    p.sub { margin: 0 0 20px; color: var(--muted); }
    label { font-weight: 600; display:block; margin: 14px 0 6px; }
    input, select {
      width: 100%;
      background: rgba(255,255,255,.04);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 12px 14px;
      outline: none;
      font-size: 16px;
    }
    input::placeholder { color: #98a0b8; }
    button {
      width: 100%;
      border: none;
      border-radius: 14px;
      padding: 14px 18px;
      margin-top: 16px;
      font-weight: 800;
      letter-spacing: 0.3px;
      cursor: pointer;
      color: white;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .msg { margin-top: 12px; font-weight: 600; }
    .ok { color: var(--ok); }
    .err { color: var(--err); }
    small { color: var(--muted); }
    footer { margin-top: 16px; color: var(--muted); font-size: 12px; text-align: center; }

    /* Countdown styles */
    .countdown { 
      display: grid; gap: 10px; margin-bottom: 18px; 
      padding: 14px; border: 1px solid rgba(255,255,255,.12); border-radius: 16px;
      background: linear-gradient(180deg, rgba(166,77,255,.06), rgba(255,77,196,.03));
    }
    .countdown .title { font-weight: 800; letter-spacing: .3px; }
    .when { color: var(--muted); font-size: 14px; }
    .tickgrid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .tick { 
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px; 
      padding: 14px; text-align: center;
    }
    .num { font-size: clamp(22px, 5vw, 32px); font-weight: 900; line-height: 1; }
    .lbl { color: var(--muted); font-size: 12px; margin-top: 4px; display:block; }
  </style>
</head>
<body>
  <main class="card">
    <!-- Countdown block -->
    <div class="countdown" role="timer" aria-live="polite">
      <div class="title">Big Drawing Countdown</div>
      <div class="tickgrid">
        <div class="tick"><div id="dd" class="num">0</div><span class="lbl">Days</span></div>
        <div class="tick"><div id="hh" class="num">0</div><span class="lbl">Hours</span></div>
        <div class="tick"><div id="mm" class="num">0</div><span class="lbl">Minutes</span></div>
        <div class="tick"><div id="ss" class="num">0</div><span class="lbl">Seconds</span></div>
      </div>
      <div class="when">Dec 1, 2025 · 12:00 PM ET</div>
    </div>

    <h1>Bullish Sweeps — Entry Portal</h1>
    <p class="sub">Backfill allowed from <strong>Aug 1, 2025</strong>. Use the same wallet/email every time.</p>

    <form id="entryForm" method="POST">
      <label>Entry Type</label>
      <select name="entry_type" required>
        <option value="daily_submission">Daily submission</option>
        <option value="unlock_18_docks">Unlocked to 18 docks</option>
        <option value="referral">Referral</option>
        <option value="60_day_streak">60-day streak</option>
      </select>

      <div class="row">
        <div>
          <label>Entry Date</label>
          <input type="date" name="entry_date" required>
          <small>Pick any date since Aug 1, 2025</small>
        </div>
        <div>
          <label>Wallet Address</label>
          <input type="text" name="wallet_address" placeholder="0x..." required pattern="0x[a-fA-F0-9]40">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Email</label>
          <input type="email" name="email" required>
        </div>
        <div>
          <label>Full Name</label>
          <input type="text" name="full_name" required>
        </div>
      </div>

      <label>Tx Hash <small>(optional for daily/streak)</small></label>
      <input type="text" name="tx_hash" placeholder="0x...">

      <label>Referred Wallet <small>(for referral claims)</small></label>
      <input type="text" name="referred_wallet" placeholder="0x...">

      <label>Evidence Link <small>(optional)</small></label>
      <input type="url" name="evidence" placeholder="https://...">

      <!-- Honeypot anti-bot -->
      <input type="text" name="website" style="position:absolute;left:-9999px;opacity:0" tabindex="-1" autocomplete="off">

      <button type="submit">Submit Entry</button>
      <p id="msg" class="msg"></p>

      <!-- Totals panel -->
      <div id="totalsPanel" class="totals" style="margin-top:18px; padding:14px; border:1px solid rgba(255,255,255,.12); border-radius:12px;">
        <div style="font-weight:700; margin-bottom:8px;">Check My Totals</div>
        <div class="row">
          <div>
            <label>Wallet (0x…)</label>
            <input type="text" id="totalsWallet" placeholder="0x...">
          </div>
          <div>
            <label>Email</label>
            <input type="email" id="totalsEmail" placeholder="you@example.com">
          </div>
        </div>
        <button type="button" id="checkTotalsBtn" style="margin-top:12px;">Check Totals</button>
        <div id="totalsBox" style="margin-top:12px; line-height:1.35;"></div>
      </div>
    </form>

    <footer>© <span id="year"></span> Bullish Moon</footer>
  </main>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwFe5STQuH-sOu_uB0HTRANkLGnTUAujp8jvwW7ShrHvbqwATfeSepGqKciUPq1tD2C/exec';
    const f = document.getElementById('entryForm');
    const msg = document.getElementById('msg');
    const dateInput = f.querySelector('input[name="entry_date"]');
    const yearSpan = document.getElementById('year');
    yearSpan.textContent = new Date().getFullYear();

    // Countdown target (Noon ET on 2025-12-01 = 17:00:00Z)
    const TARGET_UTC = '2025-12-01T17:00:00Z';
    const dd = document.getElementById('dd');
    const hh = document.getElementById('hh');
    const mm = document.getElementById('mm');
    const ss = document.getElementById('ss');

    function updateCountdown() {
      const now = new Date();
      const t = Date.parse(TARGET_UTC) - now.getTime();
      if (t <= 0) {
        dd.textContent = '0'; hh.textContent = '0'; mm.textContent = '0'; ss.textContent = '0';
        return;
      }
      const s = Math.floor(t / 1000);
      const days = Math.floor(s / 86400);
      const hours = Math.floor((s % 86400) / 3600);
      const minutes = Math.floor((s % 3600) / 60);
      const seconds = s % 60;
      dd.textContent = String(days);
      hh.textContent = String(hours).padStart(2, '0');
      mm.textContent = String(minutes).padStart(2, '0');
      ss.textContent = String(seconds).padStart(2, '0');
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Set date min/max
    const min = '2025-08-01';
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm_ = String(today.getMonth()+1).padStart(2,'0');
    const dd_ = String(today.getDate()).padStart(2,'0');
    const max = `${yyyy}-${mm_}-${dd_}`;
    dateInput.min = min;
    dateInput.max = max;
    dateInput.value = max;

    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = 'Submitting...';
      msg.className = 'msg';
      if (f.website && f.website.value) { msg.textContent = 'Bot detected.'; msg.classList.add('err'); return; }

      const fd = new FormData(f);
      try {
        const r = await fetch(SCRIPT_URL, { method:'POST', body: fd });
        const j = await r.json();
        if (j.ok) {
          msg.textContent = 'Success! Your entry was recorded.';
          msg.classList.add('ok');
          // auto-show totals for the submitted wallet/email
          const submittedWallet = f.querySelector('input[name="wallet_address"]').value.trim().toLowerCase();
          const submittedEmail  = f.querySelector('input[name="email"]').value.trim();
          document.getElementById('totalsWallet').value = submittedWallet;
          document.getElementById('totalsEmail').value  = submittedEmail;
          const res = await fetchTotals(submittedWallet, submittedEmail);
          renderTotals(res);

          f.reset();
          dateInput.value = max;
        } else {
          msg.textContent = 'Error: ' + (j.error || 'Unknown');
          msg.classList.add('err');
        }
      } catch (err) {
        msg.textContent = 'Network error. Please try again.';
        msg.classList.add('err');
      }
    });

    // ---- Totals helpers ----
    async function fetchTotals(wallet, email) {
      const url = new URL(SCRIPT_URL);
      url.searchParams.set('action', 'totals');
      if (wallet) url.searchParams.set('wallet', wallet);
      if (email)  url.searchParams.set('email', email);
      const r = await fetch(url.toString());
      const j = await r.json();
      return j;
    }

    function renderTotals(payload) {
      const box = document.getElementById('totalsBox');
      if (!payload || !payload.ok) {
        box.innerHTML = '<span class="err">Could not fetch totals.</span>';
        return;
      }
      const t = payload.totals || { entries:{all:0,verified:0,pending:0}, tokens:{all:0,verified:0,pending:0} };
      const fmt = (n) => (typeof n === 'number' ? n.toLocaleString() : n);
      let html = `
        <div><strong>Entries:</strong> ${fmt(t.entries.all)} <small>(Verified: ${fmt(t.entries.verified)}, Pending: ${fmt(t.entries.pending)})</small></div>
        <div><strong>Tokens:</strong> ${fmt(t.tokens.all)} <small>(Verified: ${fmt(t.tokens.verified)}, Pending: ${fmt(t.tokens.pending)})</small></div>
      `;
      if (payload.breakdown) {
        html += '<div style="margin-top:8px"><strong>By Type</strong></div>';
        for (const [type, b] of Object.entries(payload.breakdown)) {
          html += `
            <div style="margin-left:8px">
              <div><em>${type}</em> — Entries: ${fmt(b.entries.all)} (V:${fmt(b.entries.verified)}/P:${fmt(b.entries.pending)}), Tokens: ${fmt(b.tokens.all)} (V:${fmt(b.tokens.verified)}/P:${fmt(b.tokens.pending)})</div>
            </div>`;
        }
      }
      html += `<div style="margin-top:6px; color:#9aa0b6;"><small>Note: Only <strong>Verified</strong> entries/tokens count for drawings. Pending items are approved after review.</small></div>`;
      box.innerHTML = html;
    }

    document.getElementById('checkTotalsBtn').addEventListener('click', async () => {
      const wallet = document.getElementById('totalsWallet').value.trim().toLowerCase();
      const email  = document.getElementById('totalsEmail').value.trim();
      try {
        const res = await fetchTotals(wallet, email);
        renderTotals(res);
      } catch (err) {
        document.getElementById('totalsBox').innerHTML = '<span class="err">Network error fetching totals.</span>';
      }
    });
  </script>
</body>
</html>


